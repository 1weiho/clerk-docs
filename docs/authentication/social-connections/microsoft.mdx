---
description: Learn how to set up social connection with Microsoft.
---

# OAuth with Microsoft Azure Entra ID

<TutorialHero
  beforeYouStart={[
    {
      title: "A Clerk application is required.",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },
    {
      title: "A Microsoft Azure account is required.",
      link: "https://azure.microsoft.com/en-us/free/",
      icon: "user-circle",
    }
  ]}
>

- Use Microsoft Azure Entra ID to authenticate users with OAuth.

</TutorialHero>

Enabling OAuth with Microsoft Azure Entra ID (formerly [Active Directory](https://learn.microsoft.com/en-us/entra/fundamentals/new-name)) allows your users to sign in and sign up to your Clerk application with their Microsoft account.

Adding social connection with Microsoft Azure to your app with Clerk only requires populating the **Client ID**, **Client Secret** and **Authorized redirect URI** in your instance settings.

To make the development flow as smooth as possible, Clerk uses preconfigured shared OAuth credentials and redirect URIs for development instances - no other configuration is needed.

For production instances, you will need to generate your own Client ID and Client Secret using your Microsoft Azure account.


<Steps>


### Create a Microsoft Entra ID app

> [!TIP]
> If you already have a Microsoft Entra ID app you'd like to connect to Clerk, select your app from the Entra ID dashboard and skip to [the next step in this tutorial](#get-your-client-id-and-client-secret).

1. Under the **Azure services** section on the homepage of [the Azure portal](https://portal.azure.com/#home), select **[Microsoft Entra ID](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Overview)**.
1. In the sidebar, select **[App registrations](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps)**, then select **New Registration** in the main page view. You'll be taken to the **Register an application** page.
1. Fill out the form as follows:
    1. Under **Name**, name the application whatever you'd like. "Clerk Demo App", for example.
    1. Under **Supported account types**, select **Accounts in any organizational directory (Any Microsoft Entra ID tenant â€“ Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**.
    1. Under **Redirect URI (Optional)**, select **Web**.
    1. Finally, select **Register** to submit the form.

### Get your client ID and client secret

Once your Microsoft Entra ID app is created, or once you select your app from the Entra ID dashboard, you'll be taken to its **Overview**.

1. From your app's overview, copy the **Application (client) ID** and save it somewhere secure. It's required connecting your Microsoft Entra ID app to your Clerk application.
1. On this same page, under **Client credentials**, select **Add a certificate or secret** to generate a Client Secret.
1. You'll be taken to the **Certificate & secrets** tab, where you can select the **New client secret** button. In the modal that appears, add a description and set an expiration time for your secret.
    > [!IMPORTANT]
    > When your secret expires, your social connection will stop working until you generate a new client secret and add it to your Clerk app.
1. Copy the test in your new client secret's **Value** field and save it somewhere secure. You'll add it to your Clerk application later, alongside your client ID.

### Connect Entra ID app and get your redirect URI

1. In another tab, visit the Clerk Dashboard.
1. In the sidebar, go to **User & Authentication > [Social Connections](https://dashboard.clerk.com/last-active?path=user-authentication/social-connections)**. In the list of **Auth Providers**, enable **Microsoft**.
1. Ensure that both **Enable for sign-up and sign-in** and **Use custom credentials** are toggled on. Then:
    - Under **Client ID**, add the value you copied from **Application (client) ID** in the Entra ID dashboard.
    - Under **Client Secret**, add the client secret value you generated in the Entra ID dashboard.
    - Copy the **Authorized redirect URI**. You need it for the final step to configure your Entra ID app.
    - Select **Save**.

### Enable OpenID

For OAuth to function, Clerk requires an `id_token` from Microsoft Entra ID.

1. Return to the tab where your Microsoft Entra ID application dashboard is open.
1. In the sidebar, select **Authentication**, then select **Add a platform**.
1. In the **Redirect URIs** field of the modal that appears, add your Clerk application's authorized redirect URI.

</Steps>

### Stay secure against the nOAuth vulnerability

A vulnerability called [nOAuth](https://www.descope.com/blog/post/noauth) has been recently discovered in Microsoft's Azure AD OAuth applications. This vulnerability can lead to full account takeovers, as attackers can spoof the provided email and potentially gain full control of a victim's account.

To protect users, Clerk has implemented stringent measures against the Microsoft OAuth provider, enforcing stricter checks on verified email addresses. However, this has impacted the functionality of users using Azure AD.

Microsoft has introduced an optional claim, `xms_edov`, that can be added to your Azure application. This claim provides additional context to determine whether the returned email is verified.

To enable this optional claim, you'll need to follow these steps:

Navigate to your Azure application's **Token configuration** page, and click on **Add optional claim**.

![Add optional claims](/docs/images/authentication-providers/microsoft/noauth-optional-claims-init.png)

Select the `email` and `xms_pdl` claims for both **ID** and **Access**, and click on **Add**.

<Callout type="info">
    At the time of writing, the `xms_edov` claim is still in preview, and may not be available for all applications. So we'll choose another one from the list and we'll rename it later on in the manifest.
</Callout>

![Select claims](/docs/images/authentication-providers/microsoft/noauth-optional-claims-select.png)

Accept the permission changes. This will add `email` in your API permissions.

![Accept permissions](/docs/images/authentication-providers/microsoft/noauth-optional-claims-permissions.png)

Navigate to the **Manifest** page, and update the `idToken` and `accessToken` values names from `xms_pdl` to `xms_edov`.

![Update manifest](/docs/images/authentication-providers/microsoft/noauth-optional-claims-manifest.png)

Navigate back to the **Token configuration** page, and check the `xms_edov` claim for both **ID** and **Access**.

![Check claims](/docs/images/authentication-providers/microsoft/noauth-optional-claims-check.png)

Now you're all set! Microsoft will send the `xms_edov` claim in the token, and Clerk will use it to determine whether the email is verified or not, even if it is used with Azure AD.

## Limitations

- Currently Clerk supports only the `common` tenant type, which is intended for allowing sign-ins both from organization members and public Microsoft users.
- Only credentials of type `secret` are currently supported (not the `certificate` type).

Selecting the desired tenant type (`common`, `organizations`, `consumers` or specific tenant ID) will become available in an upcoming version of Clerk.

If you are using SAML with Microsoft, the different tenant types *are* supported and you can disregard these limitations.

## Next steps

<div className="container mx-auto my-4">
  <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
    <Cards title="SAML SSO with Microsoft Azure AD" description="Learn how to integrate Microsoft Azure AD with Clerk using SAML SSO." link="/docs/authentication/saml/azure" cta="Learn More" />

    <Cards title="Account Linking" description="Learn how Clerk handles account linking and manages unverified email addresses from OAuth providers." link="/docs/authentication/social-connections/account-linking" cta="Learn More" />
  </div>
</div>