---
description: Learn how to set up social connection with Microsoft.
---

# OAuth with Microsoft Azure Entra ID

<TutorialHero
  beforeYouStart={[
    {
      title: "A Clerk application is required.",
      link: "/docs/quickstarts/setup-clerk",
      icon: "clerk",
    },
    {
      title: "A Microsoft Azure account is required.",
      link: "https://azure.microsoft.com/en-us/free/",
      icon: "user-circle",
    }
  ]}
>

- Use Microsoft Azure Entra ID to authenticate users with OAuth.
- Protect your application form [the nOAuth exploit](https://www.descope.com/blog/post/noauth).

</TutorialHero>

Enabling OAuth with Microsoft Azure Entra ID (formerly [Active Directory](https://learn.microsoft.com/en-us/entra/fundamentals/new-name)) allows your users to sign in and sign up to your Clerk application with their Microsoft account.

Adding social connection with Microsoft Azure to your app with Clerk only requires populating the **Client ID**, **Client Secret** and **Authorized redirect URI** in your instance settings.

To make the development flow as smooth as possible, Clerk uses preconfigured shared OAuth credentials and redirect URIs for development instances - no other configuration is needed.

For production instances, you will need to generate your own Client ID and Client Secret using your Microsoft Azure account.


<Steps>


### Create a Microsoft Entra ID app

> [!TIP]
> If you already have a Microsoft Entra ID app you'd like to connect to Clerk, select your app from the Entra ID dashboard and skip to [the next step in this tutorial](#get-your-client-id-and-client-secret).

1. Under the **Azure services** section on the homepage of [the Azure portal](https://portal.azure.com/#home), select **[Microsoft Entra ID](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/Overview)**.
1. In the sidebar, select **[App registrations](https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps)**, then select **New Registration** in the main page view. You'll be taken to the **Register an application** page.
1. Fill out the form as follows:
    1. Under **Name**, name the application whatever you'd like. "Clerk Demo App", for example.
    1. Under **Supported account types**, select **Accounts in any organizational directory (Any Microsoft Entra ID tenant – Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**.
    1. Under **Redirect URI (Optional)**, select **Web**.
    1. Finally, select **Register** to submit the form.

### Get your client ID and client secret

Once your Microsoft Entra ID app is created, or once you select your app from the Entra ID dashboard, you'll be taken to its **Overview**.

1. From your app's overview, copy the **Application (client) ID** and save it somewhere secure. It's required connecting your Microsoft Entra ID app to your Clerk application.
1. On this same page, under **Client credentials**, select **Add a certificate or secret** to generate a Client Secret.
1. You'll be taken to the **Certificate & secrets** tab, where you can select the **New client secret** button. In the modal that appears, add a description and set an expiration time for your secret.
    > [!IMPORTANT]
    > When your secret expires, your social connection will stop working until you generate a new client secret and add it to your Clerk app.
1. Copy the test in your new client secret's **Value** field and save it somewhere secure. You'll add it to your Clerk application later, alongside your client ID.

### Connect Entra ID app and get your redirect URI

1. In another tab, visit the Clerk Dashboard.
1. In the sidebar, go to **User & Authentication > [Social Connections](https://dashboard.clerk.com/last-active?path=user-authentication/social-connections)**. In the list of **Auth Providers**, enable **Microsoft**.
1. Ensure that both **Enable for sign-up and sign-in** and **Use custom credentials** are toggled on. Then:
    - Under **Client ID**, add the value you copied from **Application (client) ID** in the Entra ID dashboard.
    - Under **Client Secret**, add the client secret value you generated in the Entra ID dashboard.
    - Copy the **Authorized redirect URI**. You need it for the final step to configure your Entra ID app.
    - Select **Save**.

### Enable OpenID

For OAuth to function, Clerk requires an `id_token` from Microsoft Entra ID.

1. Return to the tab where your Microsoft Entra ID application dashboard is open.
1. In the sidebar, select **Authentication**, then select **Add a platform**.
1. In the **Redirect URIs** field of the modal that appears, add your Clerk application's authorized redirect URI. Do the same in the **Front-channel logout URL** field.

### Test your OAuth

The simplest way to test your OAuth is to visit your Clerk application's account portal, which Clerk creates for all applications.

1. In the Clerk Dashboard, in the sidebar, go to **Account Portal**, then open the **Sign-in** page. The URL should resemble:
    - **For development** – `https://your-domain.accounts.dev/sign-in`
    - **For production** – `https://accounts.your-domain.com/sign-in`
1. On the sign-in page, you should see **Continue with Microsoft** as an option. Use it to sign in with your Microsoft account.

### Secure your app against the nOAuth vulnerability

[nOAuth](https://www.descope.com/blog/post/noauth) is an exploit in Microsoft Entra ID OAuth applications that can lead to full account takeovers via email address spoofing. To protect users, Clerk enforces stricter checks on verified email addresses.

For further security, Microsoft has an optional `xms_edov` claim, which provides additional context to that can be used to determine whether the returned email is verified.

To enable this optional claim, you must:

1. Navigate to your Azure application in the Microsoft Entra ID dashboard, In the sidebar, select **Token configuration**. On this page, select **Add optional claim**.
1. Select **ID**, then in the checklist that appears enable the `email` and `xms_pdl` claims. When you select **Add**, a modal will appear asking you to **Turn on the Microsoft Graph email permission**. Enable it, then select **Add** to complete the form.
    > [!NOTE]
    > At the time of writing, the `xms_edov` claim is still in preview, and may not be available for all applications. So we'll choose another one from the list and we'll rename it later on in the manifest.
1. Do the same as the previous step, selecting **Access** instead. When you're done, the list of **Optional claims** on this page should have 4 items: both the `email` and `xms_pdl` permissions twice, once for **ID** and once for **Access**.
1. In the sidebar, go to **Manifest**. On this page, search for `"acceptMappedClaims"` and change its value from `null` to `true`.
1. On the same page, search for `"optionalClaims"` where you'll find the `idToken` and `accessToken` arrays. Each array has an object with the name `xms_pdl`. Change the name to `xms_edov`. Finally, select **Save**.
1. In the sidebar, navigate back to **Token configuration** and confirm that the list of **Optional claims** includes 2 for `email` and 2 for `xms_edov`, one each for **ID** and **Access**.

With these steps complete, Microsoft will send the `xms_edov` claim in the token, and Clerk will use it to determine whether the email is verified or not, even if it is used with Microsoft Entra ID.

</Steps>

## Limitations

- Currently Clerk supports only the `common` tenant type, which is intended for allowing sign-ins both from organization members and public Microsoft users
    - Selecting the desired tenant type (`common`, `organizations`, `consumers` or specific tenant ID) will become available in an upcoming version of Clerk.
- Only credentials of type `secret` are currently supported (not the `certificate` type).

> [!TIP]
> If you are using SAML with Microsoft, the different tenant types *are* supported and you can disregard these limitations.

## Next steps

<div className="container mx-auto my-4">
  <div className="grid grid-cols-1 gap-6 md:grid-cols-2">
    <Cards title="SAML SSO with Microsoft Azure AD" description="Learn how to integrate Microsoft Azure AD with Clerk using SAML SSO." link="/docs/authentication/saml/azure" cta="Learn More" />

    <Cards title="Account Linking" description="Learn how Clerk handles account linking and manages unverified email addresses from OAuth providers." link="/docs/authentication/social-connections/account-linking" cta="Learn More" />
  </div>
</div>